<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Créateur de build (béta)</title>
    <link rel="stylesheet" href="../styles/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #1e1e1e;
            color: #fff;
            margin: 0;
            padding: 0;
        }

        header {
            text-align: center;
            margin-bottom: 20px; /* Ajoute un espacement entre l'image et les menus */
        }

        .header-image {
            max-width: 100%;
            height: auto;
        }

        .menu-container {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            width: 80%;
            max-width: 1200px;
            margin: 0 auto;
            background-color: #2c2c2c;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }

        .menu-section {
            background-color: #333;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }

        .menu-section h2 {
            font-size: 18px;
            margin-bottom: 10px;
            color: #f4f4f4;
        }

        .menu-section button {
            background-color: #ff6600;
            color: #fff;
            border: none;
            padding: 10px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
        }

        .menu-section button:hover {
            background-color: #8b3902;
        }
        .menu-section ul {
            list-style: none;
            padding: 0;
            margin: 10px 0 0;
        }
        .menu-section ul li {
            margin: 5px 0;
            font-size: 14px;
        }
        .menu-section ul li a {
            color: #8b3902;
            text-decoration: none;
        }
        .menu-section ul li a:hover {
            text-decoration: underline;
        }
        .dropdown {
            position: relative;
            display: inline-block;
        }
        .dropbtn {
            background-color: #8b3902;
            color: white;
            padding: 10px 15px;
            font-size: 14px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        .dropdown-content {
            display: none;
            position: absolute;
            background-color: #333;
            min-width: 160px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            border-radius: 5px;
            z-index: 1;
        }
        .dropdown-content a {
            color: #fff;
            padding: 10px 15px;
            text-decoration: none;
            display: block;
            text-align: left;
        }
        .dropdown-content a:hover {
            background-color: #444;
        }
        .dropdown:hover .dropdown-content {
            display: block;
        }
        .dropdown:hover .dropbtn {
            background-color: #8b3902;
        }
        .stat-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin: 10px 0;
        }
        .stat-item span {
            flex: 1;
            text-align: left;
        }
        .stat-buttons {
            display: flex;
            gap: 5px;
        }
        .stat-buttons button {
            background-color: #ff6600;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 5px;
            cursor: pointer;
        }
        .stat-buttons button:hover {
            background-color: #8b3902;
        }
        #selected-lumina-list {
            max-height: 150px; /* Limite la hauteur à environ 5 éléments */
            overflow-y: auto; /* Active la barre de défilement verticale */
            padding: 10px;
            background-color: #2c2c2c;
            border: 1px solid #444;
            border-radius: 5px;
        }
        .dropdown:hover .dropdown-menu,
        .dropdown:focus-within .dropdown-menu {
            display: block; /* Le menu reste ouvert lorsqu'il est survolé ou activé */
        }

        .dropdown-menu {
            display: none; /* Masqué par défaut */
            position: absolute;
            top: 100%;
            left: 0;
            background-color: #333;
            padding: 10px;
            border-radius: 5px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            z-index: 10;
        }

        .dropdown-menu a {
            color: #fff;
            text-decoration: none;
            padding: 5px 10px;
            display: block;
            border-radius: 5px;
        }

        .dropdown-menu a:hover {
            background-color: #444;
        }
    </style>
</head>
<body>
    <header>
        <img src="../images/title.png" alt="Clair Obscur Ressources FR" class="header-image">
        <button class="menu-toggle">Menu</button> <!-- Bouton pour mobile -->
        <nav>
            <ul>
                <button class="menu-close">Fermer</button> <!-- Bouton pour fermer le menu -->
                <li><a href="../index.html">Accueil</a></li> <!-- Lien vers la racine -->
                <li><a href="../tabs/armes.html">Armes</a></li>
                <li><a href="../tabs/competences-de-monoco.html">Compétences de Monoco</a></li>
                <li><a href="../tabs/disques.html">Disques</a></li>
                                <!-- Dropdown menu Pictos/Lumina -->
                <li class="dropdown" tabindex="0">
                    <a href="#" class="dropdown-toggle">Pictos/Luminas<span class="arrow">&#9662;</span></a>
                    <ul class="dropdown-menu">
                        <li><a href="../tabs/pictos.html">Pictos</a></li>
                        <li><a href="../tabs/lumina.html">Luminas</a></li>
                    </ul>
                </li>
                <li><a href="../tabs/tenues.html">Tenues</a></li>
                <!-- Dropdown menu Build -->
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle">Builds<span class="arrow">&#9662;</span></a>
                    <ul class="dropdown-menu">
                <li><a href="../Builder/build.html">Crée un build (bétâ)</a></li>
                <li><a href="../Builder/buildlist.html">Liste des builds (bétâ)</a></li>
                </ul>
                <!-- Dropdown menu Guides -->
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle">Guides<span class="arrow">&#9662;</span></a>
                    <ul class="dropdown-menu">
                        <li><a href="../tabs/journauxexp.html">Journaux d'expéditions</a></li>
                        <li><a href="../tabs/questitem.html">Objet de quête</a></li>
                        <li><a href="../tabs/lostgestral.html">Gestrals Perdu</a></li>
                    </ul>
                    <!-- Dropdown menu Guides -->
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle">Autres<span class="arrow">&#9662;</span></a>
                    <ul class="dropdown-menu">
                        <li><a href="../tabs/personnages.html">Personnages</a></li>
                        <li><a href="https://expedition33.wiki.fextralife.com/Expedition+33+Wiki">Fextralife</a></li>
                        <li><a href="https://mapgenie.io/clair-obscur-expedition-33">Mapgenie</a></li>
                    </ul>
                    <li><a href="../steamrss.html">News</a></li>
                    <li><a href="https://discord.com/invite/dAbAg3UVxv"><i class="fab fa-discord"></i>Discord</a></li>
                </li>
                    </ul>
                </li>
            </ul>
        </nav>
    </header>
    <div class="menu-container">
        <div class="menu-section">
            <h2>Personnages</h2>
            <div class="dropdown">
                <button class="dropbtn">Sélectionner un personnage</button>
                <div class="dropdown-content">
                    <a href="#" onclick="selectCharacter('Gustave')">Gustave</a>
                    <a href="#" onclick="selectCharacter('Lune')">Lune</a>
                    <a href="#" onclick="selectCharacter('Sciel')">Sciel</a>
                    <a href="#" onclick="selectCharacter('Maelle')">Maelle</a>
                    <a href="#" onclick="selectCharacter('Monoco')">Monoco</a>
                    <a href="#" onclick="selectCharacter('Verso')">Verso</a>
                </div>
            </div>
            <p id="selected-character" style="margin-top: 10px; font-size: 16px; color: #f4f4f4;">Aucun personnage sélectionné</p>
        </div>
        <div class="menu-section">
            <h2>Armes</h2>
            <div class="dropdown">
                <button class="dropbtn" id="weapon-button">Sélectionner une arme</button>
                <div class="dropdown-content" id="weapon-menu">
                    <!-- Les options seront chargées dynamiquement -->
                </div>
            </div>
            <p id="selected-weapon" style="margin-top: 10px; font-size: 16px; color: #f4f4f4;">Aucune arme sélectionnée</p>
        </div>
        <div class="menu-section">
            <h2>Compétences</h2>
            <button>Selectionner Compétences</button>
            <ul>
A VENIR
            </ul>
        </div>
        <div class="menu-section">
            <h2>Pictos</h2>
            <div class="dropdown">
                <button class="dropbtn" id="picto-button">Sélectionner un picto</button>
                <div class="dropdown-content" id="picto-menu">
                    <!-- Les pictos seront chargés dynamiquement -->
                </div>
            </div>
            <p id="selected-picto" style="margin-top: 10px; font-size: 16px; color: #f4f4f4;">Aucun picto sélectionné</p>
            <ul id="selected-picto-list" style="margin-top: 10px; list-style: none; padding: 0; color: #f4f4f4;"></ul>
        </div>
        <div class="menu-section">
            <h2>Luminas</h2>
            <div class="dropdown">
                <button class="dropbtn" id="lumina-button">Sélectionner un Lumina</button>
                <div class="dropdown-content" id="lumina-menu">
                    <!-- Les Luminas seront chargés dynamiquement -->
                    <a href="#" onclick="selectLumina('Nom du Lumina', 10, event)">Nom du Lumina</a>
                </div>
            </div>
            <p id="selected-lumina" style="margin-top: 10px; font-size: 16px; color: #f4f4f4;">Aucun Lumina sélectionné</p>
            <ul id="selected-lumina-list" style="margin-top: 10px; list-style: none; padding: 0; color: #f4f4f4;"></ul>
            <p id="total-cost" style="margin-top: 10px; font-size: 16px; color: #f4f4f4;">Coût total : 0</p>
        </div>
        <div class="menu-section">
            <h2>Stats</h2>
            <ul>
                <li class="stat-item">
                    <span>Vitalité:</span> <span id="vitality">0</span>
                    <div class="stat-buttons">
                        <button onclick="updateStat('vitality', 1, event)">+</button>
                        <button onclick="updateStat('vitality', -1, event)">-</button>
                    </div>
                </li>
                <li class="stat-item">
                    <span>Force:</span> <span id="force">0</span>
                    <div class="stat-buttons">
                        <button onclick="updateStat('force', 1, event)">+</button>
                        <button onclick="updateStat('force', -1, event)">-</button>
                    </div>
                </li>
                <li class="stat-item">
                    <span>Agilité:</span> <span id="agility">0</span>
                    <div class="stat-buttons">
                        <button onclick="updateStat('agility', 1, event)">+</button>
                        <button onclick="updateStat('agility', -1, event)">-</button>
                    </div>
                </li>
                <li class="stat-item">
                    <span>Défense:</span> <span id="defense">0</span>
                    <div class="stat-buttons">
                        <button onclick="updateStat('defense', 1, event)">+</button>
                        <button onclick="updateStat('defense', -1, event)">-</button>
                    </div>
                </li>
                <li class="stat-item">
                    <span>Chance:</span> <span id="luck">0</span>
                    <div class="stat-buttons">
                        <button onclick="updateStat('luck', 1, event)">+</button>
                        <button onclick="updateStat('luck', -1, event)">-</button>
                    </div>
                </li>
            </ul>
        </div>
        <div class="menu-section">
            <button id="save-button" style="margin-top: 20px; background-color: #ff6600; color: #fff; border: none; padding: 10px 15px; border-radius: 5px; cursor: pointer;">Sauvegarder</button>
            <p id="save-status" style="margin-top: 10px; font-size: 14px; color: #f4f4f4;"></p>
        </div>
    </div>

<div id="dialog-overlay" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.8); z-index: 1000;">
    <div id="dialog-box" style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: #333; padding: 20px; border-radius: 10px; width: 300px; color: #fff; text-align: center;">
        <h3>Informations du Build</h3>
        <label for="title" style="display: block; margin-bottom: 10px;">Titre :</label>
        <input type="text" id="title" style="width: 100%; padding: 5px; margin-bottom: 15px; border-radius: 5px; border: none;">
        <label for="pseudo" style="display: block; margin-bottom: 10px;">Pseudo :</label>
        <input type="text" id="pseudo" style="width: 100%; padding: 5px; margin-bottom: 15px; border-radius: 5px; border: none;">
        <label for="description" style="display: block; margin-bottom: 10px;">Description :</label>
        <textarea id="description" rows="4" style="width: 100%; padding: 5px; border-radius: 5px; border: none;"></textarea>
        <div style="margin-top: 15px;">
            <button id="save-dialog" style="background-color: #28a745; color: #fff; border: none; padding: 10px 15px; border-radius: 5px; cursor: pointer;">Sauvegarder</button>
            <button id="cancel-dialog" style="background-color: #dc3545; color: #fff; border: none; padding: 10px 15px; border-radius: 5px; cursor: pointer; margin-left: 10px;">Annuler</button>
        </div>
    </div>
</div>

<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
<script>
        const firebaseConfig = {
        apiKey: "AIzaSyAnVOPY9sF5Hdo0Pr_wnLHHzGodMu8m5Kk",
        authDomain: "cor33fr-6d60b.firebaseapp.com",
        databaseURL: "https://cor33fr-6d60b-default-rtdb.europe-west1.firebasedatabase.app",
        projectId: "cor33fr-6d60b",
        storageBucket: "cor33fr-6d60b.firebasestorage.app",
        messagingSenderId: "155454546374",
        appId: "1:155454546374:web:9ad2b70565a890b04712c7",
        measurementId: "G-6Q5NJ8533G"
};

const app = firebase.initializeApp(firebaseConfig);
const database = firebase.database();
</script>
    <script>
        let selectedCharacter = null;

        function selectCharacter(name) {
            const characterDisplay = document.getElementById('selected-character');
            characterDisplay.textContent = `${name} - Niveau 1`;
            selectedCharacter = name; // Enregistre le personnage sélectionné
            resetStats(); // Réinitialise les stats lors de la sélection d'un nouveau personnage
            loadWeapons(); // Charge les armes pour le personnage sélectionné
        }

        function loadWeapons() {
            const weaponMenu = document.getElementById('weapon-menu');
            weaponMenu.innerHTML = ''; // Vide le menu des armes

            // Détermine le fichier source des armes en fonction du personnage
            let weaponSource = '';
            switch (selectedCharacter) {
                case 'Gustave':
                    weaponSource = '../tabs/gustaveverso.html';
                    break;
                case 'Lune':
                    weaponSource = '../tabs/lune.html';
                    break;
                case 'Sciel':
                    weaponSource = '../tabs/sciel.html';
                    break;
                case 'Maelle':
                    weaponSource = '../tabs/maelle.html';
                    break;
                case 'Monoco':
                    weaponSource = '../tabs/monoco.html';
                    break;
                case 'Verso':
                    weaponSource = '../tabs/gustaveverso.html';
                    break;
            }

            // Si aucun personnage n'est sélectionné, afficher un message
            if (!weaponSource) {
                weaponMenu.innerHTML = '<p style="color: #fff; padding: 10px;">Veuillez sélectionner un personnage d\'abord.</p>';
                return;
            }

            // Charge dynamiquement le contenu du fichier HTML
            fetch(weaponSource)
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Erreur lors du chargement des armes.');
                    }
                    return response.text();
                })
                .then(html => {
                    // Crée un conteneur temporaire pour analyser le HTML
                    const tempDiv = document.createElement('div');
                    tempDiv.innerHTML = html;

                    // Récupère toutes les balises <li class="weapon-name">
                    const weaponItems = tempDiv.querySelectorAll('li.weapon-name');

                    // Ajoute chaque arme au menu des armes
                    weaponItems.forEach(item => {
                        const weaponOption = document.createElement('a');
                        weaponOption.href = '#'; // Vous pouvez personnaliser le lien ici
                        weaponOption.textContent = item.textContent; // Utilise le texte de l'arme
                        weaponOption.onclick = () => selectWeapon(item.textContent); // Définit l'action de sélection
                        weaponMenu.appendChild(weaponOption);
                    });
                })
                .catch(error => {
                    weaponMenu.innerHTML = `<p style="color: #fff; padding: 10px;">Erreur : ${error.message}</p>`;
                });
        }

        function selectWeapon(weaponName) {
            const weaponDisplay = document.getElementById('selected-weapon');
            weaponDisplay.textContent = `Arme sélectionnée : ${weaponName}`;
        }

        function updateStat(statId, change, event) {
            const statElement = document.getElementById(statId);
            let currentValue = parseInt(statElement.textContent, 10);

            // Vérifie si Ctrl ou Shift est enfoncé
            if (event.ctrlKey) {
                change *= 5; // Multiplie par 5 si Ctrl est enfoncé
            } else if (event.shiftKey) {
                change *= 10; // Multiplie par 10 si Shift est enfoncé
            }

            currentValue += change;

            // Empêche les valeurs négatives et limite à 99
            if (currentValue < 0) currentValue = 0;
            if (currentValue > 99) currentValue = 99;

            // Vérifie si plus de 3 stats atteignent 99
            if (currentValue === 99) {
                const stats = ['vitality', 'force', 'agility', 'defense', 'luck'];
                const maxedStats = stats.filter(statId => parseInt(document.getElementById(statId).textContent, 10) === 99);
                if (maxedStats.length >= 3 && parseInt(statElement.textContent, 10) !== 99) {
                    alert("Vous ne pouvez augmenter que 3 statistiques à 99.");
                    return;
                }
            }

            statElement.textContent = currentValue;

            updateLevel(); // Met à jour le niveau du personnage
        }

        function updateLevel() {
            const stats = ['vitality', 'force', 'agility', 'defense', 'luck'];
            let totalStats = 0;

            // Calcule la somme des statistiques
            stats.forEach(statId => {
                const statValue = parseInt(document.getElementById(statId).textContent, 10);
                totalStats += statValue;
            });

            // Calcule le niveau en fonction des nouvelles règles
            let level = 1;
            if (totalStats >= 4) {
                level = Math.min(Math.floor((totalStats - 4) / 3) + 2, 99);
            }

            // Met à jour l'affichage du niveau
            const characterDisplay = document.getElementById('selected-character');
            const currentText = characterDisplay.textContent.split(' - ')[0]; // Récupère le nom du personnage
            characterDisplay.textContent = `${currentText} - Niveau ${level}`;
        }

        function resetStats() {
            const stats = ['vitality', 'force', 'agility', 'defense', 'luck'];
            stats.forEach(statId => {
                document.getElementById(statId).textContent = '0';
            });
            updateLevel(); // Réinitialise également le niveau
        }

        let selectedPictos = []; // Tableau pour stocker les pictos sélectionnés

        function loadPictos() {
            const pictoMenu = document.getElementById('picto-menu');
            pictoMenu.innerHTML = ''; // Vide le menu des pictos

            // Chemin vers le fichier pictos.html
            const pictoSource = '../tabs/pictos.html';

            // Charge dynamiquement le contenu du fichier HTML
            fetch(pictoSource)
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Erreur lors du chargement des pictos.');
                    }
                    return response.text();
                })
                .then(html => {
                    // Crée un conteneur temporaire pour analyser le HTML
                    const tempDiv = document.createElement('div');
                    tempDiv.innerHTML = html;

                    // Récupère toutes les balises <li class="picto-name">
                    const pictoItems = tempDiv.querySelectorAll('li.picto-name');

                    // Ajoute chaque picto au menu des pictos
                    pictoItems.forEach(item => {
                        const pictoOption = document.createElement('a');
                        pictoOption.href = '#'; // Vous pouvez personnaliser le lien ici
                        pictoOption.textContent = item.textContent; // Utilise le texte du picto
                        pictoOption.onclick = () => selectPicto(item.textContent); // Définit l'action de sélection
                        pictoMenu.appendChild(pictoOption);
                    });
                })
                .catch(error => {
                    pictoMenu.innerHTML = `<p style="color: #fff; padding: 10px;">Erreur : ${error.message}</p>`;
                });
        }

        function selectPicto(pictoName) {
            const pictoList = document.getElementById('selected-picto-list');

            // Vérifie si le picto est déjà sélectionné
            if (selectedPictos.includes(pictoName)) {
                alert(`Le picto "${pictoName}" est déjà sélectionné.`);
                return;
            }

            // Vérifie si le nombre maximum de pictos est atteint
            if (selectedPictos.length >= 3) {
                alert("Vous ne pouvez sélectionner que 3 pictos maximum.");
                return;
            }

            // Ajoute le picto sélectionné au tableau
            selectedPictos.push(pictoName);

            // Crée un élément de liste pour afficher le picto
            const listItem = document.createElement('li');
            listItem.textContent = `${pictoName}`;
            listItem.style.display = 'flex';
            listItem.style.alignItems = 'center';
            listItem.style.marginBottom = '5px';

            // Ajoute un bouton pour retirer le picto
            const removeButton = document.createElement('button');
            removeButton.textContent = 'Retirer';
            removeButton.style.marginLeft = '10px';
            removeButton.style.backgroundColor = '#ff4d4d';
            removeButton.style.color = '#fff';
            removeButton.style.border = 'none';
            removeButton.style.padding = '5px 10px';
            removeButton.style.borderRadius = '5px';
            removeButton.style.cursor = 'pointer';
            removeButton.onclick = () => removePicto(pictoName, listItem);

            listItem.appendChild(removeButton);
            pictoList.appendChild(listItem);
        }

        function removePicto(pictoName, listItem) {
            // Retire le picto du tableau
            selectedPictos = selectedPictos.filter(picto => picto !== pictoName);

            // Retire l'élément de la liste
            listItem.remove();

            // Si aucun picto n'est sélectionné, affiche un message par défaut
            if (selectedPictos.length === 0) {
                const pictoDisplay = document.getElementById('selected-picto');
                pictoDisplay.textContent = 'Aucun picto sélectionné';
            }
        }

        // Charge les pictos au chargement de la page
        document.addEventListener('DOMContentLoaded', loadPictos);

        let selectedLuminas = []; // Tableau pour stocker les Luminas sélectionnés
        let totalCost = 0; // Variable pour stocker le coût total

        function loadLuminas() {
            const luminaMenu = document.getElementById('lumina-menu');
            luminaMenu.innerHTML = ''; // Vide le menu des Luminas

            // Chemin vers le fichier lumina.html
            const luminaSource = '../tabs/lumina.html';

            // Charge dynamiquement le contenu du fichier HTML
            fetch(luminaSource)
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Erreur lors du chargement des Luminas.');
                    }
                    return response.text();
                })
                .then(html => {
                    // Crée un conteneur temporaire pour analyser le HTML
                    const tempDiv = document.createElement('div');
                    tempDiv.innerHTML = html;

                    // Récupère toutes les lignes du tableau contenant les Luminas
                    const luminaRows = tempDiv.querySelectorAll('tbody tr');

                    // Ajoute chaque Lumina au menu des Luminas
                    luminaRows.forEach(row => {
                        const nameCell = row.querySelector('td:nth-child(1)'); // Première colonne : Nom
                        const costCell = row.querySelector('td:nth-child(3)'); // Troisième colonne : Coût

                        if (nameCell && costCell) {
                            const luminaOption = document.createElement('a');
                            luminaOption.href = '#'; // Vous pouvez personnaliser le lien ici
                            luminaOption.textContent = `${nameCell.textContent} (Coût : ${costCell.textContent})`; // Nom et coût
                            luminaOption.onclick = () => selectLumina(nameCell.textContent, parseInt(costCell.textContent), event); // Définit l'action de sélection
                            luminaMenu.appendChild(luminaOption);
                        }
                    });
                })
                .catch(error => {
                    luminaMenu.innerHTML = `<p style="color: #fff; padding: 10px;">Erreur : ${error.message}</p>`;
                });
        }

        function selectLumina(luminaName, luminaCost, event) {
            event.preventDefault(); // Empêche le comportement par défaut du lien

            const luminaList = document.getElementById('selected-lumina-list');
            const totalCostDisplay = document.getElementById('total-cost');

            // Vérifie si le Lumina est déjà sélectionné
            if (selectedLuminas.some(lumina => lumina.name === luminaName)) {
                alert(`Le Lumina "${luminaName}" est déjà sélectionné.`);
                return;
            }

            // Ajoute le Lumina sélectionné au tableau
            selectedLuminas.push({ name: luminaName, cost: luminaCost });
            totalCost += luminaCost; // Ajoute le coût du Lumina au coût total

            // Crée un élément de liste pour afficher le Lumina
            const listItem = document.createElement('li');
            listItem.textContent = `${luminaName} (Coût : ${luminaCost})`;
            listItem.style.display = 'flex';
            listItem.style.alignItems = 'center';
            listItem.style.marginBottom = '5px';

            // Ajoute un bouton pour retirer le Lumina
            const removeButton = document.createElement('button');
            removeButton.textContent = 'Retirer';
            removeButton.style.marginLeft = '10px';
            removeButton.style.backgroundColor = '#ff4d4d';
            removeButton.style.color = '#fff';
            removeButton.style.border = 'none';
            removeButton.style.padding = '5px 10px';
            removeButton.style.borderRadius = '5px';
            removeButton.style.cursor = 'pointer';
            removeButton.onclick = () => removeLumina(luminaName, luminaCost, listItem);

            listItem.appendChild(removeButton);
            luminaList.appendChild(listItem);

            // Met à jour l'affichage du coût total
            totalCostDisplay.textContent = `Coût total : ${totalCost}`;
        }

        function removeLumina(luminaName, luminaCost, listItem) {
            const totalCostDisplay = document.getElementById('total-cost');

            // Retire le Lumina du tableau
            selectedLuminas = selectedLuminas.filter(lumina => lumina.name !== luminaName);
            totalCost -= luminaCost; // Soustrait le coût du Lumina du coût total

            // Retire l'élément de la liste
            listItem.remove();

            // Met à jour l'affichage du coût total
            totalCostDisplay.textContent = `Coût total : ${totalCost}`;
        }

        // Charge les Luminas au chargement de la page
        document.addEventListener('DOMContentLoaded', loadLuminas);

        function saveBuild() {
            // Affiche la boîte de dialogue
            const dialogOverlay = document.getElementById('dialog-overlay');
            dialogOverlay.style.display = 'block';

            // Ajoute les événements pour les boutons de la boîte de dialogue
            document.getElementById('save-dialog').onclick = () => {
                const title = document.getElementById('title').value.trim();
                const pseudo = document.getElementById('pseudo').value.trim();
                const description = document.getElementById('description').value.trim();

                if (!title || !pseudo || !description) {
                    alert("Veuillez remplir tous les champs.");
                    return;
                }

                // Récupère les données sélectionnées
                const selectedCharacter = document.getElementById('selected-character').textContent || "Aucun personnage sélectionné";
                const selectedWeapon = document.getElementById('selected-weapon').textContent || "Aucune arme sélectionnée";

                // Vérifie si les données sont valides
                if (!selectedCharacter || selectedCharacter === "Aucun personnage sélectionné") {
                    alert("Veuillez sélectionner un personnage avant de sauvegarder.");
                    dialogOverlay.style.display = 'none';
                    return;
                }

                // Crée un objet contenant les données
                const buildData = {
                    title: title,
                    pseudo: pseudo,
                    description: description,
                    character: selectedCharacter,
                    weapon: selectedWeapon,
                    pictos: selectedPictos || [], // Utilise le tableau global des pictos sélectionnés
                    luminas: selectedLuminas || [], // Utilise le tableau global des Luminas sélectionnés
                    totalCost: totalCost || 0 // Utilise la variable globale pour le coût total
                };

                // Envoie les données à Firebase
                const buildsRef = firebase.database().ref('builds');
                buildsRef.push(buildData, (error) => {
                    if (error) {
                        alert("Erreur lors de la sauvegarde du build.");
                    } else {
                        alert("Build sauvegardé avec succès !");
                    }
                });

                // Ferme la boîte de dialogue
                dialogOverlay.style.display = 'none';
            };

            document.getElementById('cancel-dialog').onclick = () => {
                // Ferme la boîte de dialogue sans sauvegarder
                dialogOverlay.style.display = 'none';
            };
        }

        document.addEventListener('DOMContentLoaded', () => {
            document.getElementById('save-button').addEventListener('click', saveBuild);
        });

        document.addEventListener('DOMContentLoaded', () => {
            // Vérifiez que Firebase est initialisé
            if (typeof firebase === 'undefined') {
                console.error("Firebase n'est pas chargé correctement.");
                return;
            }

            // Ajoutez l'écouteur d'événement pour le bouton "Sauvegarder"
            const saveButton = document.getElementById('save-button');
            if (saveButton) {
                saveButton.addEventListener('click', saveBuild);
            } else {
                console.error("Le bouton 'Sauvegarder' avec l'ID 'save-button' n'a pas été trouvé.");
            }
        });
    </script>
    <script src="../scripts/app.js"></script>
<footer>
        <ul>
            <li><a href="contact.html">Contact</a></li>
            <li><a href="mentionlegal.html">Mentions Légales</a></li>
        </ul>
    <p>&copy; 2025 Zatsu - Clair Obscur : Expédition 33 Ressources FR</p>
</footer>
</body>
</html>
